# 지역 및 업종 Embedding을 활용한 새로운 지역 경제 지표 제시

# 소개
- 본 프로젝트는 2021 금융 데이터 경진대회에 제출한 프로젝트입니다.
- 저는 본 프로젝트에서 데이터 전처리, 모델링을 맡았습니다.
- 제가 본 프로젝트에서 가장 중요하게 생각한 부분은 기업의 신용리스크 파악을 위해 금융 기관에서 가장 중요하게 여기는 부분은 무엇일까 입니다. 
- 데이터 분석을 통해서 대부분에 기업의 재무적 정보가 결측치인 것을 발견하였고, 실제 현업도 이와 유사할 것이라고 생각했습니다. 그래서 재무적 정보가 존재하지 않는 기업의 신용리스크 파악을 위한 새로운 변수가 필요하다고 생각했습니다. 실제 주어진 데이터에서도 재무적 정보는 결측치이지만 지역, 업종 등의 비재무적 정보는 결측치가 아닌 경우가 대다수였습니다.
- 이에 비재무적 정보를 실제 기업의 신용리스크 파악을 위한 변수로써 활용하기 위해 정량적 지표로 만드는 방향으로 본 프로젝트를 진행했습니다.

# 요약
- **문제 정의 (Matplotlib, Seaborn)**
    - 실제로 주어진 기업 데이터에서 약 60만개 이상에 기업의 재무적 정보가 결측치, 그러나 비재무적 정보는 결측치가 아닌 경우가 대다수
    - 따라서 기업의 재무적 정보(영업이익, 매출액 등)를 얻을 수 없는 상태에서 비재무적 정보(지역, 업종과 같은 텍스트)를 바탕으로 기업을 평가하기 위한 방안 제안
- **재무적 정보를 바탕으로 기업의 위험도를 평가할 수 있는 Target 변수 생성 (Pandas, Numpy)**
    - K-means 알고리즘을 활용한 Target 변수 생성 (단순히 매출과 이익이 높은 기업일수록 좋게 평가하는 편향적인 추세를 보임)
    - 변동성을(변동 계수) 고려한 Target 변수 생성 (매출과 이익의 평균과 표준 편차를 거려하여 편향 감소)
- **비재무적 정보에 재무적 정보의 패턴이 반영될 수 있는 Embedding생성 (Pytorch)**
    - 지역, 업종과 같은 비재무적 정보를 GMF, NCF, NMF 모델에 학습 Embedding으로 두어 Embedding이 Target의 패턴을 표현할 수 있도록 모델을 학습
    - 실제 학습된 지역 임베딩을 시각화 했을 때 비슷한 Target을 가지는 지역끼리 가깝게 위치한다는 것을 확인
- **본 Embedding은 재무 정보는 비어 있지만, 업종 지역 등의 정보는 존재하는 기업을 평가하는 추가 지표로써 활용 할 수 있고, 나아가 지역의 위험도를 반영할 수 있는 지역 경제 지표로 활용 가능함**
- **[분석 코드](https://github.com/SeongBeomLEE/Project/blob/main/2021_findata/%EB%B6%84%EC%84%9D%EC%BD%94%EB%93%9C_%EB%B2%94%EB%82%B4%EB%A0%A4%EC%98%A8%EB%8B%A4.ipynb)**
- **[결과 보고서](https://github.com/SeongBeomLEE/Project/blob/main/2021_findata/%EA%B2%B0%EA%B3%BC%EB%B3%B4%EA%B3%A0%EC%84%9C_%EB%B2%94%EB%82%B4%EB%A0%A4%EC%98%A8%EB%8B%A4.pdf)**
- **[최종 발표 자료](https://github.com/SeongBeomLEE/Project/blob/main/2021_findata/%EB%B0%9C%ED%91%9C%EC%9E%90%EB%A3%8C_%EB%B2%94%EB%82%B4%EB%A0%A4%EC%98%A8%EB%8B%A4.pdf)**

# 내용

## 1) 데이터 설명

- 지역별통계데이터(한국기업데이터)
    - 기업의 영업 이익을 바탕으로 Target 변수를 생성
    - Target 변수를 바탕으로 시군구명, 업종분류명 등의 임베딩을 학습
    - 임베딩 그 자체가 Target을 반영하는 그 지역, 업종의 새로운 지표로써 활용이 가능
- 광역시도별 업종별 가맹점 데이터(신한카드)
    - 기업의 매출을 바탕으로 Target 변수를 생성
    - Target 변수를 바탕으로 광역시도명, 업종분류명 등의 임베딩을 학습
    - 임베딩 그 자체가 Target을 반영하는 그 지역, 업종의 새로운 지표로써 활용이 가능

## 2) 데이터 전처리

- 우리의 목적은 Target에 대한 정보가 없을 때 단순히 지역, 업종 명등의 텍스트 데이터를 바탕으로 해당 기업의 위험도를 예측하는 것이다. 따라서 과거의 데이터를 바탕으로 미래를 예측하는 방식으로 데이터 셋을 분리
- 지역별통계데이터(한국기업데이터)
    - 가장 많은 결측치가 존재하는 데이터로, 주요 가설 증명에 활용
    - 결측치 - Test / 가장 최신의 데이터(202012) - Val /  나머지 데이터 - Train
- 광역시도별 업종별 가맹점 데이터(신한카드)
    - 가장 최신의 데이터(202009) - Test / 202003 데이터 - Val / 나머지 데이터 - Train

## 3) EDA

![image](https://user-images.githubusercontent.com/65529313/172417360-e5be060d-c6da-46b8-86fb-335b9752b760.png)

- 전체 약 104만개의 데이터 중에서 약 60만개의 데이터가 기업에 대한 기본적인 정보만 있을 뿐 영업이익과 같은 재무적 요소에 대한 값이 비어있는 것을 확인

## 4) Target 생성

- 군집화를  활용한 방법과 변동계수(CV)를 고려한 방법을 통해 Target 변수를 생성 및 검증을 진행
- 군집화를 활용한 방법
    - 각 데이터를 기준년월별로 분리 (년도마다의 영향력을 반영하기 위해)
    - 데이터의 첨도가 심해서 classing 기법을 사용
    - 매출, 영업 이익 관련 변수를 모두 계급화 (10개 그룹)
    - 구해진 계급화 변수를 모두 더함
    - 더해진 값을 100점 만점 기준으로 정규화
    - 본 방식의 단점은 단순히 좋은 기업일 수록 좋게 평가하는 편향적인 추세를 보임. 따라서 위험도로 쓰기에는 적합하지 않다고 생각함
- 변동계수를 고려한 방법
    - 각 데이터를 기준년월별로 분리 (년도마다의 영향력을 반영하기 위해)
    - 기업구분에 따른 영업이익중위액에 대한 분산이 커 기업구분에 따라 영업이익중위액을 나눔
    - 변동계수(CV)를 구할 때 시군구별 및 기업구분별 변동계수와 업종별 및 기업구분별 변동계수로 나누어 CV를 산정
    - 영업이익중위액과 시군구별 CV, 업종별 CV 변수를 모두 계급화 (10개 그룹)
    - 구해진 계급화 변수를 모두 더함
    - 더해진 값을 100점 만점 기준으로 정규화
    - 본 방식은 비재무적 정보에 따른 매출과 이익의 평균과 표준 편차를 각각 고려하여 편향이 감소하였음, 이에 최종 방법으로 선택

## 5) Model

- Matrix Factorization 방식은 어떠한 변수 간 관계의 상호작용을 내적을 통해서 Latent Space로 나타내어 Latent Factor를 찾는 것
- 이러한 MF의 방식을 적용하여 Target을 예측하는 지역과 업종 간의 상호작용을 나타내는Latent Space를 구하고 지역의 Latent Factor를 지역경제지표로 활용하는 방식을 제안
- 우리는 변수 간의 복잡한 상호 작용을 조금 더 잘 표현할 수 있도록 DNN 기반의 MF 모델을 구현함
- General Matrix Factorization
    - 우리의 데이터는 학습해야 할 임베딩이 3가지 이상이기 때문에 기존의 MF 방식은 활용할 수가 없음
    - GMF의 경우에는 element-wise product를 통해서 3가지 이상의 임베딩을 학습할 수 있기 때문에 본 방식을 활용
    - 본 방식은 Latent Space를 찾음과 동시에 학습된 임베딩을 바탕으로 Linear Layer를 통과시켜 Target을 예측함
- Neural Collaborative Filtering
    - GMF에 비선형성이 추가된 형태의 모델
    - 우리가 표현하고자 하는 변수 간의 상호작용은 매우 복잡한 관계를 가지고 있다고 생각함
    - NCF 모델 같은 경우에는 예측을 하는 과정에서 활성화 함수를 거치기 때문에 비선형성을 가질 수 있으며, 이러한 비선형성을 바탕으로 복잡한 상호작용을 조금 더 잘 표현할 수 있음
    - NCF 모델은 하나의 변수에 하나의 임베딩을 가지고 있으며, 복잡한 상호작용도 학습할 수 있기에 본 분석에 가장 부합되는 모델로 생각됨
    - 실제로 분석 결과 본 NCF 모델이 우리의 Task에서 가장 좋은 성능을 보임
- Neural Matrix Factorization
    - 학습이 안정적인 GMF와 복잡한 상호관계를 더 잘 Capture할 수 있는 NCF를 서로 결합한 모델
    - 본 모델은 GMF와 NCF에 들어가는 임베딩을 다르게 설정하여 학습시킴으로써 하나의 변수에 2개의 임베딩을 얻게 되어, 하나의 임베딩이 필요한 우리의 Task에는 부합하지 않은 형태의 모델이라고 생각함

## 6) 학습

- 텍스트인 시군구명, 기업구분, 업종대분류명, 업종중분류명을 64차원의 Embedding Layer로 설정함
- 각각의 Embedding Layer를 서로 element-wise product를 통해서 상호작용을 표현함
- 나온 값을 Output Layer에 통과시켜서 Target 과의 MSE가 최소가 되도록 각각의 Embedding Layer를 학습
- 학습된 시군구명의 Embedding Layer를 Latent Space로 칭하고, Latent Space 속에 64차원의 Latent Factor를 지역경제지표로 활용

## 7) 결과

![image](https://user-images.githubusercontent.com/65529313/172417443-419c5d0c-df7e-4ca7-a47a-417837ddb590.png)

- 모델 학습 결과 NCF 모델이 가장 좋은 성능을 보여줬음

![image](https://user-images.githubusercontent.com/65529313/172417506-37578e39-74ef-4a33-a93f-0c5fb33086e1.png)

- Target 값이 상위에 위치한 영등포구를 중심으로 그 인접 위치에 Target 값이 큰 지역이 서로 가깝게 임베딩 되어 있음
- Target 값이 서로 유사한 위치의 지역끼리 서로 가깝다는 것을 확인할 수 있음

# 아쉬운 점
- 본 모델의 학습 곡선과 Loss를 보았을 때 모델이 제대로 학습되었다고 볼 수 없음
- 또한 본 모델의 경우 학습시켜야하는 임베딩이 많아, 모든 임베딩이 Target의 표현을 학습한다는 보장이 없음
- 단순히 주어진 임베딩의 개수 만큼 표현할 수 있는 Target의 값의 범위가 존재해서 그에 맞는 결과를 보여주었다고 생각됨
- 따라서 본 모델은 임베딩의 개수 만큼에 경우의 수를 가진 Target을 표현할 수 밖에 없다고 생각됨
- 기업의 위험도를 반영하는 임베딩을 만들겠다는 취지는 좋았으나 그 과정에서 적절한 모델을 사용했다고 보장할 수는 없을 것 같음
- 따라서 본 프로젝트를 더욱더 발전시키기 위해서는 현재 보다 더 나은 방식으로 Target의 패턴을 표현할 수 있는 모델이 필요함
